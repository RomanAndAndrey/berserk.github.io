# Документация Функций (JavaScript)

В данном документе описана работа основных функций файла `js/script.js`.

---

## Глобальные объекты и Состояние

### `state`
**Описание**: Объект, хранящий текущее состояние приложения.
**Поля**:
- `currentVolume`: Номер текущего тома.
- `currentChapter`: Номер текущей главы.
- `currentSection`: Активный экран приложения (например, 'manga', 'viewer').

### `mangaDatabase`
**Описание**: Объект, содержащий структуру всей манги (тома, главы, страницы). Заполняется из `generatedMangaData`.

---

## Модуль `app` (Основная логика)

### `init()`
**Описание**: Точка входа в приложение.
**Как работает**:
1. Вызывает `setupNavigation()` для настройки обработчиков событий.
2. Определяет первый доступный том из базы данных и устанавливает его как текущий.
3. Вызывает `renderVolumes()` для отрисовки библиотеки.
4. Вызывает `setupGallery()` для инициализации галереи материалов.

### `setupNavigation()`
**Описание**: Настраивает интерактивность интерфейса.
**Как работает**:
1. Находит все ссылки в боковом меню (`.nav-links li`).
2. Добавляет обработчик `click` для переключения активного класса и вызова `showSection` с соответствующим ID.
3. Настраивает селекты (`select`) в просмотрщике: при изменении тома или главы вызывается `loadChapter`.
4. Настраивает кнопку сворачивания хедера (`header-toggle`): переключает CSS-класс `header-collapsed`.

### `showSection(sectionId)`
**Описание**: Управляет отображением экранов приложения (SPA-роутинг).
**Параметры**: `sectionId` (String) — ID HTML-элемента, который нужно показать.
**Как работает**:
1. Скрывает все элементы с классом `.section` (добавляет класс `hidden`).
2. Находит целевой элемент по ID и удаляет у него класс `hidden`.
3. Обновляет состояние `state.currentSection`.
4. Скроллит страницу вверх.

### `renderVolumes()`
**Описание**: Генерирует визуальное отображение библиотеки манги.
**Как работает**:
1. Очищает контейнер `#volumes-grid`.
2. Проходит циклом по всем томам в `mangaDatabase`.
3. Для каждого тома создает HTML-элемент карточки (`div.volume-card`).
4. Вставляет обложку и название тома.
5. При клике на карточку вызывает `openVolume(volNum)`.

### `openVolume(volNum)`
**Описание**: Открывает список глав для выбранного тома.
**Параметры**: `volNum` (Number/String) — номер тома.
**Как работает**:
1. Обновляет `state.currentVolume`.
2. Получает данные тома и обновляет заголовок страницы.
3. Генерирует список глав в контейнере `#chapters-container`.
4. Переключает экран на список глав (`showSection('chapters-list')`).

### `loadChapter(volNum, chNum)`
**Описание**: Загружает конкретную главу в просмотрщик.
**Параметры**: 
- `volNum` — номер тома.
- `chNum` — номер главы.
**Как работает**:
1. Парсит аргументы в целые числа.
2. Обновляет селекты навигации через `updateViewerControls`.
3. Очищает контейнер страниц `#pages-container`.
4. Получает массив страниц из базы данных.
5. Для каждой страницы создает элемент `<img>` (с `lazy` загрузкой) и добавляет в DOM.
6. Открывает секцию просмотрщика.

### `updateViewerControls(currentVol, currentCh)`
**Описание**: Синхронизирует выпадающие списки выбора тома и главы с текущим состоянием.
**Как работает**:
1. Пересоздает `<option>` для выбора тома, помечая текущий как `selected`.
2. Пересоздает `<option>` для выбора главы (только для текущего тома!), помечая текущую как `selected`.

### `goBackToChapters()`
**Описание**: Возвращает пользователя из режима чтения к списку глав.
**Как работает**: Вызывает `openVolume` с текущим номером тома.

### `setupGallery()`
**Описание**: Инициализирует страницу "Доп. материалы".
**Как работает**:
1. Заполняет сетку `#materials-gallery` изображениями из массива `materialsData`.
2. Добавляет обработчик клика на каждое изображение для открытия модального окна.
3. Настраивает закрытие модального окна по клику на крестик или фон.
